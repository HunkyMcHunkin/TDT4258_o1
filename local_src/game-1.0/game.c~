#include <stdio.h>
#include <stdlib.h>
#include <linux/fb.h>
#include <stdint.h>
#include <sys/mman.h>
#include <sys/ioctl.h>

//sett 

struct fb_copyarea rect;  //draw on screen
uint16_t *pixels;
int button;


int main(int argc, char *argv[])
{
	printf("Hello World try, I'm game!\n");
	
	//åpner driveren vår bare lesing
	int gamepad_fd = open("/dev/gamepad_group_2", 2);
	int buttonspressed = (int)getc(gamepad_fd);  //henter knapptilstander
	printf("button compleat");
	
	
	//set up frame buffer-optaderer hele skjermen når ioctl blir kaldt
	int fbfd = open("/dev/fb0", 2);
	
	//forteller hvor stor del av skjermen vi skal oppdatere -> har valgt å oppdatare hele skjermen
	rect.dx = 0;
	rect.dy = 0;
	rect.width = 320;
	rect.height = 240;
	
	//uint8_t buttons = (uint8_t)getc(gamepad_fd);  //henter knapptilstander
	
	while(1){
	//printf(buttonspressed);
	
	//grafik
	 //320*240*(16/8) //antall pixsler ganger antall bytes per pixel
	pixels = mmap(NULL, 320*240*2, PROT_READ | PROT_WRITE, MAP_SHARED, fbfd, 0); //array med pixels
	//
	int i;
	for (i=0; i<638; i++){
		pixels[i] = 0xffff; //tegner en hvit strek øverst
	}
	for (i=640; i<1278; i++){
		pixels[i] = 0x000f; //tegner en blå strek linje 2
	}
	if(buttonspressed == 0xFD){
		for (i=1500; i<10000; i++){
			pixels[i] = 0xffff;
		}
	}
	
	ioctl(fbfd, 0x4680, &rect);
	
	}
	
	return 0;
}
	
